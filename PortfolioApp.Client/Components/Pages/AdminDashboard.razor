@page "/admin/dashboard"
@inherits ComponentBase
@inject IAuthService AuthService
@inject IPortfolioService PortfolioService
@inject IProjectService ProjectService
@inject ISkillService SkillService
@inject NavigationManager Navigation

<PageTitle>Admin Dashboard</PageTitle>

<div class="min-h-screen bg-[#101e22]">
  @if (!_isLoading)
    {
    <!-- Top Navigation -->
 <nav class="border-b border-white/10 bg-white/5">
   <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
   <div class="flex h-16 items-center justify-between">
    <div class="flex items-center gap-3">
    <img src="logo_p.png?v=2" 
     alt="Portfolio Logo" 
     style="width: 24px; height: 24px; object-fit: contain; border-radius: 4px;" />
   <h1 class="text-lg font-bold text-white sm:text-xl">Admin Dashboard</h1>
       </div>
          <div class="flex items-center gap-4">
         <a href="/" class="text-sm text-gray-300 hover:text-white">View Site</a>
      <button @onclick="HandleLogout" class="rounded-lg bg-white/10 px-4 py-2 text-sm text-white transition-colors hover:bg-white/20">
       Logout
   </button>
 </div>
    </div>
      </div>
    </nav>

  <!-- Main Content -->
    <div class="mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8">
 <div class="mb-8">
         <h2 class="mb-2 text-3xl font-bold text-white">Welcome Back!</h2>
 <p class="text-gray-400">Manage your portfolio content from here.</p>
</div>

   <!-- Dashboard Cards -->
        <div class="mb-8 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4">
      <!-- Portfolio Card -->
    <a href="/admin/portfolio" class="block rounded-lg border border-white/10 bg-white/5 p-6 transition-colors hover:bg-white/10">
   <div class="mb-4 flex items-center justify-between">
       <span class="text-4xl">👤</span>
        <span class="text-2xl font-bold text-[#0db9f2]">→</span>
  </div>
 <h3 class="mb-1 text-lg font-bold text-white">Profile</h3>
      <p class="text-sm text-gray-400">Edit your portfolio details</p>
  </a>

       <!-- Projects Card -->
     <a href="/admin/projects" class="block rounded-lg border border-white/10 bg-white/5 p-6 transition-colors hover:bg-white/10">
   <div class="mb-4 flex items-center justify-between">
      <span class="text-4xl">📁</span>
   <span class="text-2xl font-bold text-[#0db9f2]">→</span>
      </div>
      <h3 class="mb-1 text-lg font-bold text-white">Projects</h3>
       <p class="text-sm text-gray-400">Manage your projects</p>
    </a>

 <!-- Skills & Tools Card -->
      <a href="/admin/skills" class="block rounded-lg border border-white/10 bg-white/5 p-6 transition-colors hover:bg-white/10">
       <div class="mb-4 flex items-center justify-between">
 <span class="text-4xl">⚡</span>
     <span class="text-2xl font-bold text-[#0db9f2]">→</span>
    </div>
     <h3 class="mb-1 text-lg font-bold text-white">Skills & Tools</h3>
     <p class="text-sm text-gray-400">Manage skills with their tools</p>
     </a>

       <!-- Resume Card -->
      <a href="/admin/resume" class="block rounded-lg border border-white/10 bg-white/5 p-6 transition-colors hover:bg-white/10">
 <div class="mb-4 flex items-center justify-between">
  <span class="text-4xl">📄</span>
       <span class="text-2xl font-bold text-[#0db9f2]">→</span>
        </div>
       <h3 class="mb-1 text-lg font-bold text-white">Resume</h3>
      <p class="text-sm text-gray-400">Upload your CV/Resume</p>
    </a>
        </div>

        <!-- Quick Stats -->
   <div class="rounded-lg border border-white/10 bg-white/5 p-6">
     <h3 class="mb-4 text-lg font-bold text-white">Quick Overview</h3>
<div class="grid grid-cols-2 gap-4 md:grid-cols-4">
    <div class="text-center">
 <div class="text-3xl font-bold text-[#0db9f2]">@_projectCount</div>
     <div class="mt-1 text-sm text-gray-400">Projects</div>
      </div>
    <div class="text-center">
<div class="text-3xl font-bold text-[#0db9f2]">@_skillCount</div>
   <div class="mt-1 text-sm text-gray-400">Skills</div>
   </div>
   <div class="text-center">
  <div class="text-3xl font-bold text-[#0db9f2]">@_toolCount</div>
 <div class="mt-1 text-sm text-gray-400">Tools</div>
       </div>
      <div class="text-center">
<div class="text-3xl font-bold text-green-400">✓</div>
       <div class="mt-1 text-sm text-gray-400">Active</div>
     </div>
   </div>
     </div>
    </div>
  }
    else
    {
     <!-- Loader BLEU uniforme -->
        <div class="flex min-h-screen items-center justify-center bg-[#101e22]">
         <div class="text-center">
   <svg class="mx-auto h-16 w-16 animate-spin text-[#0db9f2]" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
       <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
     </svg>
   <p class="mt-4 text-xl font-semibold text-[#0db9f2]">Loading...</p>
         </div>
        </div>
    }
</div>

@code {
    private bool _isLoading = true;
  private int _projectCount = 0;
    private int _skillCount = 0;
    private int _toolCount = 0;

    protected override async Task OnAfterRenderAsync(bool firstRender)
  {
      if (firstRender)
        {
        // Check authentication after render when JSRuntime is available
  if (!await AuthService.IsAuthenticatedAsync())
   {
    Navigation.NavigateTo("/admin", forceLoad: true);
      return;
   }
   
  await LoadStats();
    _isLoading = false;
        StateHasChanged();
   }
    }

    private async Task LoadStats()
  {
        try
   {
          var projects = await ProjectService.GetAllAsync();
   var skills = await SkillService.GetAllAsync();
 
       _projectCount = projects.Count();
    _skillCount = skills.Count();
        _toolCount = skills.SelectMany(s => s.Tools).Count();
        }
 catch (Exception ex)
{
       Console.WriteLine($"Error loading stats: {ex.Message}");
 }
    }

private async Task HandleLogout()
  {
        await AuthService.LogoutAsync();
      Navigation.NavigateTo("/", forceLoad: true);
  }
}
